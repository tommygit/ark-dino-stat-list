<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Dino Stat Chart (Image URL + Threshold + Search & Sort)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { color-scheme: dark; }
  body { font-family: system-ui, Arial, sans-serif; background:#111; color:#eee; margin:0; padding:24px; }
  h2 { margin:0 0 16px; }
  .card { max-width:1100px; margin:0 auto; background:#181818; border:1px solid #2a2a2a; border-radius:14px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,0.3); }
  .row { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
  input[type="text"], input[type="url"], input[type="number"], select {
    flex:1; min-width:160px; background:#101010; color:#eee; border:1px solid #333; border-radius:10px; padding:10px 12px; outline:none;
  }
  input::placeholder { color:#888; }
  button {
    background:#32a852; color:#fff; border:none; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:600;
  }
  button:hover { filter:brightness(1.08); }
  button.secondary { background:#2a2a2a; }
  button.danger { background:#b44646; }
  .btn-ghost { background:#2a2a2a; opacity:.9; }
  table { width:100%; border-collapse:collapse; margin-top:8px; }
  th, td { border-bottom:1px solid #2a2a2a; padding:10px; text-align:center; }
  th { background:#202020; position:sticky; top:0; z-index:1; }
  tbody tr:hover { background:#202020; }
  .muted { color:#9a9a9a; font-size:12px; margin-top:6px; }
  .actions { display:flex; gap:6px; justify-content:center; }
  .low { color:#3cd33c; font-weight:600; }   /* ì„ê³„ê°’ ë¯¸ë§Œ => ì´ˆë¡ */
  .high { color:#ff4d4d; font-weight:600; }  /* ì„ê³„ê°’ ì´ìƒ => ë¹¨ê°• */
  .thumb { width:84px; height:84px; object-fit:cover; border-radius:10px; border:1px solid #333; background:#0f0f0f; }
  .img-cell { display:flex; align-items:center; justify-content:center; gap:8px; flex-wrap:wrap; }
  .link-btn { background:#2c2c2c; padding:6px 10px; border-radius:8px; font-size:12px; }
  .section-title { margin:14px 0 8px; font-weight:700; }
  .controls { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  .pill { padding:8px 10px; border-radius:999px; background:#222; border:1px solid #333; }
  .sort-ind { font-size:12px; color:#bbb; }
</style>
</head>
<body>
  <div class="card">
    <h2>ğŸ¦– Dino Stat Chart â€” (ì´ë¦„ / HP / DMG / Image URL)</h2>

    <!-- ì…ë ¥ ì˜ì—­ -->
    <div class="row">
      <input type="text" id="dinoName" placeholder="Dino name (ì˜ˆ: Rex, Dread, Magma)" />
      <input type="number" id="hp" placeholder="HP (ì •ìˆ˜)" min="0" step="1" />
      <input type="number" id="dmg" placeholder="DMG (ì •ìˆ˜)" min="0" step="1" />
      <input type="url" id="imgUrl" placeholder="Image URL (ì˜ˆ: https://...jpg / .png)" />
      <button id="addBtn">Add</button>
      <button id="resetBtn" class="danger">Reset All</button>
    </div>

    <!-- ê²€ìƒ‰ & ì •ë ¬ ì»¨íŠ¸ë¡¤ -->
    <div class="section-title">ğŸ” ê²€ìƒ‰ & â†• ì •ë ¬</div>
    <div class="row controls">
      <input type="text" id="search" class="pill" placeholder="ì´ë¦„ ê²€ìƒ‰ (ë¶€ë¶„ ì¼ì¹˜)" style="flex:2; min-width:220px;" />
      <div class="pill" style="display:flex; gap:8px;">
        <button id="sortName" class="secondary">Sort Name <span id="indName" class="sort-ind"></span></button>
        <button id="sortHP" class="secondary">Sort HP <span id="indHP" class="sort-ind"></span></button>
        <button id="sortDMG" class="secondary">Sort DMG <span id="indDMG" class="sort-ind"></span></button>
        <button id="sortReset" class="btn-ghost">Reset Sort</button>
      </div>
    </div>

    <!-- ì„¤ì • ì˜ì—­ -->
    <div class="section-title">âš™ï¸ í‘œì‹œ ì„ê³„ê°’</div>
    <div class="row">
      <label style="display:flex; align-items:center; gap:8px;">
        <span>ì„ê³„ê°’(HPÂ·DMG ê³µí†µ):</span>
        <input type="number" id="threshold" min="0" step="1" style="max-width:140px;" />
      </label>
      <label style="display:flex; align-items:center; gap:8px;">
        <span>ì¡°ê±´:</span>
        <select id="rule" style="max-width:220px;">
          <option value="ge">ê°’ â‰¥ ì„ê³„ê°’ â†’ ë¹¨ê°• / ë¯¸ë§Œ â†’ ì´ˆë¡</option>
          <option value="gt">ê°’ > ì„ê³„ê°’ â†’ ë¹¨ê°• / ì´í•˜ â†’ ì´ˆë¡</option>
        </select>
      </label>
      <button id="saveCfg" class="secondary">Save Config</button>
      <button id="defaultCfg" class="secondary">Default</button>
    </div>
    <div class="muted">ê²€ìƒ‰ì–´/ì •ë ¬ì€ ì¦‰ì‹œ ì ìš©. ì„ê³„ê°’ ì„¤ì •ì€ ì €ì¥ ì‹œ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</div>

    <!-- í…Œì´ë¸” -->
    <table id="dinoTable">
      <thead>
        <tr>
          <th style="width:26%">Dino Name</th>
          <th style="width:14%">HP</th>
          <th style="width:14%">DMG</th>
          <th style="width:26%">Image</th>
          <th style="width:20%">Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
(() => {
  const LS_KEY_DATA = 'dino_stats_v5_imgurl_searchsort';
  const LS_KEY_CFG  = 'dino_stats_cfg_v1';

  /** ë°ì´í„°/ì„¤ì • **/
  /** @type {{id:string,name:string,hp:number,dmg:number,imageUrl?:string}[]} */
  let dinos = [];
  let cfg = { threshold: 200, rule: 'ge' }; // ê°’ â‰¥ ì„ê³„ê°’ì´ë©´ ë¹¨ê°•
  let view = { search: '', sortKey: null, sortDir: 'desc' }; // sortKey: 'name' | 'hp' | 'dmg' | null

  /** ì—˜ë¦¬ë¨¼íŠ¸ **/
  const $name = document.getElementById('dinoName');
  const $hp = document.getElementById('hp');
  const $dmg = document.getElementById('dmg');
  const $imgUrl = document.getElementById('imgUrl');
  const $tbody = document.querySelector('#dinoTable tbody');

  const $addBtn = document.getElementById('addBtn');
  const $resetBtn = document.getElementById('resetBtn');

  const $threshold = document.getElementById('threshold');
  const $rule = document.getElementById('rule');
  const $saveCfg = document.getElementById('saveCfg');
  const $defaultCfg = document.getElementById('defaultCfg');

  const $search = document.getElementById('search');
  const $sortName = document.getElementById('sortName');
  const $sortHP = document.getElementById('sortHP');
  const $sortDMG = document.getElementById('sortDMG');
  const $sortReset = document.getElementById('sortReset');
  const $indName = document.getElementById('indName');
  const $indHP = document.getElementById('indHP');
  const $indDMG = document.getElementById('indDMG');

  /** ìœ í‹¸ **/
  function uid() { return Math.random().toString(36).slice(2, 10); }
  function saveData() { localStorage.setItem(LS_KEY_DATA, JSON.stringify(dinos)); }
  function loadData() {
    try { const raw = JSON.parse(localStorage.getItem(LS_KEY_DATA)); dinos = Array.isArray(raw) ? raw : []; }
    catch { dinos = []; }
  }
  function saveCfg() { localStorage.setItem(LS_KEY_CFG, JSON.stringify(cfg)); }
  function loadCfg() {
    try {
      const raw = JSON.parse(localStorage.getItem(LS_KEY_CFG));
      if (raw && typeof raw === 'object') {
        if (Number.isFinite(raw.threshold) && raw.threshold >= 0) cfg.threshold = Math.trunc(raw.threshold);
        if (raw.rule === 'ge' || raw.rule === 'gt') cfg.rule = raw.rule;
      }
    } catch {}
    $threshold.value = cfg.threshold;
    $rule.value = cfg.rule;
  }
  function clearInputs() {
    $name.value = ''; $hp.value = ''; $dmg.value = ''; $imgUrl.value = ''; $name.focus();
  }
  function escapeHtml(s) { return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function validUrl(u) {
    try { const url = new URL(u); return ['http:', 'https:'].includes(url.protocol); }
    catch { return false; }
  }

  /** ì„ê³„ê°’ í‘œì‹œ ë¡œì§ **/
  function isHigh(value) { return (cfg.rule === 'ge') ? (value >= cfg.threshold) : (value > cfg.threshold); }
  function colorClass(value) { return isHigh(value) ? 'high' : 'low'; }

  /** ê²€ìƒ‰ & ì •ë ¬ **/
  function applySearchAndSort(list) {
    const term = view.search.trim().toLowerCase();
    let out = term ? list.filter(d => d.name.toLowerCase().includes(term)) : [...list];

    if (view.sortKey) {
      const k = view.sortKey;
      const dir = view.sortDir === 'asc' ? 1 : -1;
      out.sort((a,b) => {
        let va = a[k], vb = b[k];
        if (k === 'name') {
          va = va.toLowerCase(); vb = vb.toLowerCase();
          if (va < vb) return -1 * dir;
          if (va > vb) return  1 * dir;
          return 0;
        } else {
          // ìˆ«ì ì •ë ¬
          return (va - vb) * dir;
        }
      });
    }
    return out;
  }

  function setSort(key) {
    if (view.sortKey === key) {
      // ê°™ì€ í‚¤ í´ë¦­ ì‹œ ë°©í–¥ í† ê¸€
      view.sortDir = (view.sortDir === 'asc') ? 'desc' : 'asc';
    } else {
      view.sortKey = key;
      view.sortDir = (key === 'name') ? 'asc' : 'desc'; // ì´ë¦„ì€ ê¸°ë³¸ ì˜¤ë¦„ì°¨ìˆœ, ìˆ«ìëŠ” ê¸°ë³¸ ë‚´ë¦¼ì°¨ìˆœ
    }
    render();
  }
  function resetSort() {
    view.sortKey = null; view.sortDir = 'desc';
    render();
  }
  function updateSortIndicators() {
    $indName.textContent = (view.sortKey === 'name') ? (view.sortDir === 'asc' ? 'â†‘' : 'â†“') : '';
    $indHP.textContent   = (view.sortKey === 'hp')   ? (view.sortDir === 'asc' ? 'â†‘' : 'â†“') : '';
    $indDMG.textContent  = (view.sortKey === 'dmg')  ? (view.sortDir === 'asc' ? 'â†‘' : 'â†“') : '';
  }

  /** ë Œë”ë§ **/
  function render() {
    $tbody.innerHTML = '';
    updateSortIndicators();

    const display = applySearchAndSort(dinos);

    if (!display.length) {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td colspan="5" class="muted">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ì–´/ì •ë ¬ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.</td>`;
      $tbody.appendChild(tr);
      return;
    }

    display.forEach(d => {
      const img = (d.imageUrl && validUrl(d.imageUrl)) ? d.imageUrl : '';
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(d.name)}</td>
        <td class="${colorClass(d.hp)}">${d.hp}</td>
        <td class="${colorClass(d.dmg)}">${d.dmg}</td>
        <td class="img-cell">
          ${img
            ? `<a href="${img}" target="_blank" rel="noopener noreferrer" title="Open image">
                 <img class="thumb" loading="lazy" src="${img}" alt="thumb" onerror="this.src='';this.closest('td').querySelector('.img-note').textContent='(ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨)';" />
               </a>`
            : `<span class="muted">(ì´ë¯¸ì§€ ì—†ìŒ)</span>`
          }
          <button class="link-btn secondary" data-open="${d.id}">Open</button>
          <div class="img-note muted"></div>
        </td>
        <td class="actions">
          <button class="secondary" data-edit="${d.id}">Edit</button>
          <button class="danger" data-del="${d.id}">Delete</button>
        </td>
      `;
      $tbody.appendChild(tr);
    });
  }

  /** ì•¡ì…˜ë“¤ **/
  function addDino() {
    const name = $name.value.trim();
    const hp = Number($hp.value);
    const dmg = Number($dmg.value);
    const imageUrl = $imgUrl.value.trim();

    if (!name) return alert('ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    if (!Number.isFinite(hp) || hp < 0) return alert('HPëŠ” 0 ì´ìƒì˜ ì •ìˆ˜ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    if (!Number.isFinite(dmg) || dmg < 0) return alert('DMGëŠ” 0 ì´ìƒì˜ ì •ìˆ˜ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    if (imageUrl && !validUrl(imageUrl)) return alert('Image URL í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');

    dinos.push({ id: uid(), name, hp: Math.trunc(hp), dmg: Math.trunc(dmg), imageUrl: imageUrl || '' });
    saveData(); clearInputs(); render();
  }
  function deleteDino(id) {
    dinos = dinos.filter(d => d.id !== id);
    saveData(); render();
  }
  function editDino(id) {
    const t = dinos.find(d => d.id === id);
    if (!t) return;

    const name = prompt('Dino name ìˆ˜ì •', t.name);
    if (name === null) return;
    const hpStr = prompt('HP ìˆ˜ì • (ì •ìˆ˜)', String(t.hp));
    if (hpStr === null) return;
    const dmgStr = prompt('DMG ìˆ˜ì • (ì •ìˆ˜)', String(t.dmg));
    if (dmgStr === null) return;
    const urlStr = prompt('Image URL ìˆ˜ì • (ë¹ˆì¹¸ ê°€ëŠ¥)', t.imageUrl || '');
    if (urlStr === null) return;

    const hp = Number(hpStr), dmg = Number(dmgStr);
    if (!name.trim()) return alert('ì´ë¦„ì€ ë¹„ìš¸ ìˆ˜ ì—†ì–´ìš”.');
    if (!Number.isFinite(hp) || hp < 0) return alert('HPëŠ” 0 ì´ìƒì˜ ì •ìˆ˜ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    if (!Number.isFinite(dmg) || dmg < 0) return alert('DMGëŠ” 0 ì´ìƒì˜ ì •ìˆ˜ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    if (urlStr.trim() && !validUrl(urlStr.trim())) return alert('Image URL í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');

    t.name = name.trim(); t.hp = Math.trunc(hp); t.dmg = Math.trunc(dmg); t.imageUrl = urlStr.trim();
    saveData(); render();
  }
  function openImageById(id) {
    const t = dinos.find(d => d.id === id);
    if (!t) return;
    if (!t.imageUrl) return alert('ì´ë¯¸ì§€ URLì´ ì—†ìŠµë‹ˆë‹¤.');
    if (!validUrl(t.imageUrl)) return alert('Image URL í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    window.open(t.imageUrl, '_blank', 'noopener');
  }
  function resetAll() {
    if (!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”? (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)')) return;
    dinos = []; saveData(); render(); clearInputs();
  }

  /** ì„¤ì • ì €ì¥/ë³µì› **/
  function applyConfigFromUI() {
    const thr = Number($threshold.value);
    const rule = $rule.value;
    if (!Number.isFinite(thr) || thr < 0) return alert('ì„ê³„ê°’ì€ 0 ì´ìƒì˜ ì •ìˆ˜ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    cfg.threshold = Math.trunc(thr);
    cfg.rule = (rule === 'gt') ? 'gt' : 'ge';
    saveCfg();
    render();
  }
  function setDefaultCfg() {
    cfg = { threshold: 200, rule: 'ge' };
    $threshold.value = cfg.threshold;
    $rule.value = cfg.rule;
    saveCfg();
    render();
  }

  /** ì´ë²¤íŠ¸ ë°”ì¸ë”© **/
  $addBtn.addEventListener('click', addDino);
  $resetBtn.addEventListener('click', resetAll);
  [$name, $hp, $dmg, $imgUrl].forEach($el => {
    $el.addEventListener('keydown', e => { if (e.key === 'Enter') addDino(); });
  });

  // í…Œì´ë¸” ë‚´ ë²„íŠ¼ ìœ„ì„
  $tbody.addEventListener('click', e => {
    const t = e.target;
    if (!(t instanceof HTMLElement)) return;
    const delId = t.getAttribute('data-del');
    const editId = t.getAttribute('data-edit');
    const openId = t.getAttribute('data-open');
    if (delId) deleteDino(delId);
    if (editId) editDino(editId);
    if (openId) openImageById(openId);
  });

  // ê²€ìƒ‰(ë””ë°”ìš´ìŠ¤)
  let searchTimer = null;
  $search.addEventListener('input', e => {
    clearTimeout(searchTimer);
    searchTimer = setTimeout(() => {
      view.search = $search.value || '';
      render();
    }, 120);
  });

  // ì •ë ¬ ë²„íŠ¼
  $sortName.addEventListener('click', () => setSort('name'));
  $sortHP.addEventListener('click', () => setSort('hp'));
  $sortDMG.addEventListener('click', () => setSort('dmg'));
  $sortReset.addEventListener('click', resetSort);

  // ì„ê³„ê°’ ì„¤ì •
  $saveCfg.addEventListener('click', applyConfigFromUI);
  $defaultCfg.addEventListener('click', setDefaultCfg);

  // ì´ˆê¸° ë¡œë“œ
  loadData();
  loadCfg();
  render();
})();
</script>
</body>
</html>
